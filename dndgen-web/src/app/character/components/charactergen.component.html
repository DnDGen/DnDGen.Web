<h1>CharacterGen</h1>
<dndgen-loading [isLoading]="loading" [size]="sizes.Large">
  <div class="row top-buffer">
    <div class="col-sm-6">
      <ul class="nav nav-tabs" role="tablist">
          <li role="presentation" class="nav-item"><a class="nav-link active" href="#character" aria-controls="character" role="tab" data-bs-toggle="tab">Character</a></li>
          <li role="presentation" class="nav-item"><a class="nav-link" href="#leadership" aria-controls="leadership" role="tab" data-bs-toggle="tab">Leadership</a></li>
      </ul>
      <div class="tab-content">
          <div role="tabpanel" class="tab-pane fade show active" id="character">
              <form name="characterForm" #characterForm="ngForm" class="form-horizontal top-buffer" role="form">
                  <div class="form-group row">
                      <label for="alignmentRandomizerType" class="col-sm-4 col-form-label">Alignment Randomizer:</label>
                      <div class="col-sm-4">
                        @if (characterModel) {
                          <select id="alignmentRandomizerType" 
                                  name="alignmentRandomizerType"
                                  class="form-select" 
                                  [(ngModel)]="alignmentRandomizerType" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  required>
                            @for (alignmentRandomizerTypeOption of characterModel.alignmentRandomizerTypes; track $index) {
                              <option [ngValue]="alignmentRandomizerTypeOption">{{alignmentRandomizerTypeOption}}</option>
                            }
                          </select>
                        }
                      </div>
                      <div class="col-sm-4">
                        @if (characterModel && alignmentRandomizerType == 'Set') {
                          <select id="setAlignment" 
                                  name="setAlignment"
                                  class="form-select"
                                  [(ngModel)]="setAlignment"
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  [required]="alignmentRandomizerType == 'Set'">
                            @for (alignment of characterModel.alignments; track $index) {
                              <option [ngValue]="alignment">{{alignment}}</option>
                            }
                          </select>
                        }
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="classNameRandomizerType" class="col-sm-4 col-form-label">Class Randomizer:</label>
                      <div class="col-sm-4">
                        @if (characterModel) {
                          <select id="classNameRandomizerType" 
                                  name="classNameRandomizerType"
                                  class="form-select" 
                                  [(ngModel)]="classNameRandomizerType" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  required>
                            @for (classNameRandomizerTypeOption of characterModel.classNameRandomizerTypes; track $index) {
                              <option [ngValue]="classNameRandomizerTypeOption">{{classNameRandomizerTypeOption}}</option>
                            }
                          </select>
                        }
                      </div>
                      <div class="col-sm-4">
                        @if (characterModel && classNameRandomizerType == 'Set') {
                          <select id="setClassName" 
                                  name="setClassName"
                                  class="form-select"
                                  [(ngModel)]="setClassName" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  [required]="classNameRandomizerType == 'Set'">
                            @for (className of characterModel.classNames; track $index) {
                              <option [ngValue]="className">{{className}}</option>
                            }
                          </select>
                        }
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="levelRandomizerType" class="col-sm-4 col-form-label">Level Randomizer:</label>
                      <div class="col-sm-4">
                        @if (characterModel) {
                          <select id="levelRandomizerType"
                                  name="levelRandomizerType"
                                  class="form-select" 
                                  [(ngModel)]="levelRandomizerType" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  required>
                            @for (levelRandomizerTypeOption of characterModel.levelRandomizerTypes; track $index) {
                              <option [ngValue]="levelRandomizerTypeOption">{{levelRandomizerTypeOption}}</option>
                            }
                          </select>
                        }
                      </div>
                      <div class="col-sm-4">
                          <div class="checkbox-inline">
                              <label>
                                  <input id="levelAdjustCheckbox" 
                                         name="levelAdjustCheckbox" 
                                         type="checkbox" 
                                         [(ngModel)]="allowLevelAdjustments" 
                                         (input)="validateRandomizers(
                                            alignmentRandomizerType, setAlignment,
                                            classNameRandomizerType, setClassName,
                                            levelRandomizerType, setLevel, allowLevelAdjustments,
                                            baseRaceRandomizerType, setBaseRace,
                                            metaraceRandomizerType, setMetarace, forceMetarace,
                                            abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                          )"> Allow Adjustments
                              </label>
                          </div>
                      </div>
                      <div class="col-sm-4">
                        @if (levelRandomizerType == 'Set') {
                          <input id="setLevel"
                            name="setLevel"
                            pattern="^[0-9]+$"
                            class="form-control" 
                            type="number" 
                            min="1" 
                            max="20" 
                            [(ngModel)]="setLevel" 
                            (input)="validateRandomizers(
                              alignmentRandomizerType, setAlignment,
                              classNameRandomizerType, setClassName,
                              levelRandomizerType, setLevel, allowLevelAdjustments,
                              baseRaceRandomizerType, setBaseRace,
                              metaraceRandomizerType, setMetarace, forceMetarace,
                              abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                            )"
                            [required]="levelRandomizerType == 'Set'" />
                        }
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="baseRaceRandomizerType" class="col-sm-4 col-form-label">Base Race Randomizer:</label>
                      <div class="col-sm-4">
                        @if (characterModel) {
                          <select id="baseRaceRandomizerType" 
                                  name="baseRaceRandomizerType" 
                                  class="form-select" 
                                  [(ngModel)]="baseRaceRandomizerType"
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  required>
                            @for (baseRaceRandomizerTypeOption of characterModel.baseRaceRandomizerTypes; track $index) {
                              <option [ngValue]="baseRaceRandomizerTypeOption">{{baseRaceRandomizerTypeOption}}</option>
                            }
                          </select>
                        }
                      </div>
                      <div class="col-sm-4">
                        @if (characterModel && baseRaceRandomizerType == 'Set') {
                          <select id="setBaseRace" 
                                  name="setBaseRace"
                                  class="form-select"
                                  [(ngModel)]="setBaseRace" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  [required]="baseRaceRandomizerType == 'Set'">
                            @for (baseRace of characterModel.baseRaces; track $index) {
                              <option [ngValue]="baseRace">{{baseRace}}</option>
                            }
                          </select>
                        }
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="metaraceRandomizerTypes" class="col-sm-4 col-form-label">Metarace Randomizer:</label>
                      <div class="col-sm-4">
                        @if (characterModel) {
                          <select id="metaraceRandomizerType" 
                                  name="metaraceRandomizerType"
                                  class="form-select" 
                                  [(ngModel)]="metaraceRandomizerType" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  required>
                            @for (metaraceRandomizerTypeOption of characterModel.metaraceRandomizerTypes; track $index) {
                              <option [ngValue]="metaraceRandomizerTypeOption">{{metaraceRandomizerTypeOption}}</option>
                            }
                          </select>
                        }
                      </div>
                      @if (metaraceRandomizerType != 'Set' && metaraceRandomizerType != 'No Meta') {
                        <div class="col-sm-4">
                            <div class="checkbox-inline">
                                <label>
                                    <input id="forceMetaraceCheckbox" 
                                           name="forceMetaraceCheckbox" 
                                           type="checkbox" 
                                           [(ngModel)]="forceMetarace" 
                                           (input)="validateRandomizers(
                                              alignmentRandomizerType, setAlignment,
                                              classNameRandomizerType, setClassName,
                                              levelRandomizerType, setLevel, allowLevelAdjustments,
                                              baseRaceRandomizerType, setBaseRace,
                                              metaraceRandomizerType, setMetarace, forceMetarace,
                                              abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                            )"> Force
                                </label>
                            </div>
                        </div>
                      }
                      @if (characterModel && metaraceRandomizerType == 'Set') {
                        <div class="col-sm-4">
                            <select id="setMetarace" 
                                    name="setMetarace"
                                    class="form-select" 
                                    [(ngModel)]="setMetarace" 
                                    (change)="validateRandomizers(
                                      alignmentRandomizerType, setAlignment,
                                      classNameRandomizerType, setClassName,
                                      levelRandomizerType, setLevel, allowLevelAdjustments,
                                      baseRaceRandomizerType, setBaseRace,
                                      metaraceRandomizerType, setMetarace, forceMetarace,
                                      abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                    )"
                                    [required]="metaraceRandomizerType == 'Set'">
                              @for (metarace of characterModel.metaraces; track $index) {
                                <option [ngValue]="metarace">{{metarace}}</option>
                              }
                            </select>
                        </div>
                      }
                  </div>
                  <div class="form-group row">
                      <label for="abilitiesRandomizerType" class="col-sm-4 col-form-label">Abilities Randomizer:</label>
                      <div class="col-sm-4">
                        @if (characterModel) {
                          <select id="abilitiesRandomizerType" 
                                  name="abilitiesRandomizerType"
                                  class="form-select" 
                                  [(ngModel)]="abilitiesRandomizerType" 
                                  (change)="validateRandomizers(
                                    alignmentRandomizerType, setAlignment,
                                    classNameRandomizerType, setClassName,
                                    levelRandomizerType, setLevel, allowLevelAdjustments,
                                    baseRaceRandomizerType, setBaseRace,
                                    metaraceRandomizerType, setMetarace, forceMetarace,
                                    abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                  )"
                                  required>
                            @for (abilitiesRandomizerTypeOption of characterModel.abilitiesRandomizerTypes; track $index) {
                              <option [ngValue]="abilitiesRandomizerTypeOption">{{abilitiesRandomizerTypeOption}}</option>
                            }
                          </select>
                        }
                      </div>
                      <div class="col-sm-4">
                        @if (abilitiesRandomizerType == 'Set') {
                          <div class="checkbox-inline">
                              <label>
                                  <input id="abilitiesAdjustCheckbox" 
                                         name="abilitiesAdjustCheckbox" 
                                         type="checkbox" 
                                         [(ngModel)]="allowAbilitiesAdjustments" 
                                         (input)="validateRandomizers(
                                            alignmentRandomizerType, setAlignment,
                                            classNameRandomizerType, setClassName,
                                            levelRandomizerType, setLevel, allowLevelAdjustments,
                                            baseRaceRandomizerType, setBaseRace,
                                            metaraceRandomizerType, setMetarace, forceMetarace,
                                            abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                          )"> Allow Adjustments
                              </label>
                          </div>
                        }
                      </div>
                  </div>
                  @if (abilitiesRandomizerType == 'Set') {
                    <div class="form-group row">
                        <label for="setStrength" class="col-sm-2 col-form-label">Strength:</label>
                        <div class="col-sm-2">
                          <input id="setStrength" 
                                 name="setStrength"
                                 pattern="^[0-9]+$"
                                 class="form-control" 
                                 type="number" 
                                 min="0" 
                                 [(ngModel)]="setStrength" 
                                 (input)="validateRandomizers(
                                  alignmentRandomizerType, setAlignment,
                                  classNameRandomizerType, setClassName,
                                  levelRandomizerType, setLevel, allowLevelAdjustments,
                                  baseRaceRandomizerType, setBaseRace,
                                  metaraceRandomizerType, setMetarace, forceMetarace,
                                  abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                )"
                                 [required]="abilitiesRandomizerType == 'Set'" />
                        </div>
                        <label for="setConstitution" class="col-sm-2 col-form-label">Constitution:</label>
                        <div class="col-sm-2">
                          <input id="setConstitution" 
                                 name="setConstitution"
                                 pattern="^[0-9]+$"
                                 class="form-control" 
                                 type="number" 
                                 min="0" 
                                 [(ngModel)]="setConstitution" 
                                 (input)="validateRandomizers(
                                  alignmentRandomizerType, setAlignment,
                                  classNameRandomizerType, setClassName,
                                  levelRandomizerType, setLevel, allowLevelAdjustments,
                                  baseRaceRandomizerType, setBaseRace,
                                  metaraceRandomizerType, setMetarace, forceMetarace,
                                  abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                )"
                                 [required]="abilitiesRandomizerType == 'Set'" />
                        </div>
                        <label for="setDexterity" class="col-sm-2 col-form-label">Dexterity:</label>
                        <div class="col-sm-2">
                          <input id="setDexterity" 
                                 name="setDexterity"
                                 pattern="^[0-9]+$"
                                 class="form-control" 
                                 type="number" 
                                 min="0" 
                                 [(ngModel)]="setDexterity" 
                                 (input)="validateRandomizers(
                                  alignmentRandomizerType, setAlignment,
                                  classNameRandomizerType, setClassName,
                                  levelRandomizerType, setLevel, allowLevelAdjustments,
                                  baseRaceRandomizerType, setBaseRace,
                                  metaraceRandomizerType, setMetarace, forceMetarace,
                                  abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                )"
                                 [required]="abilitiesRandomizerType == 'Set'" />
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="setIntelligence" class="col-sm-2 col-form-label">Intelligence:</label>
                        <div class="col-sm-2">
                          <input id="setIntelligence" 
                                 name="setIntelligence"
                                 pattern="^[0-9]+$"
                                 class="form-control" 
                                 type="number" 
                                 min="0" 
                                 [(ngModel)]="setIntelligence" 
                                 (input)="validateRandomizers(
                                  alignmentRandomizerType, setAlignment,
                                  classNameRandomizerType, setClassName,
                                  levelRandomizerType, setLevel, allowLevelAdjustments,
                                  baseRaceRandomizerType, setBaseRace,
                                  metaraceRandomizerType, setMetarace, forceMetarace,
                                  abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                )"
                                 [required]="abilitiesRandomizerType == 'Set'" />
                        </div>
                        <label for="setWisdom" class="col-sm-2 col-form-label">Wisdom:</label>
                        <div class="col-sm-2">
                          <input id="setWisdom" 
                                 name="setWisdom"
                                 pattern="^[0-9]+$"
                                 class="form-control" 
                                 type="number" 
                                 min="0" 
                                 [(ngModel)]="setWisdom" 
                                 (input)="validateRandomizers(
                                  alignmentRandomizerType, setAlignment,
                                  classNameRandomizerType, setClassName,
                                  levelRandomizerType, setLevel, allowLevelAdjustments,
                                  baseRaceRandomizerType, setBaseRace,
                                  metaraceRandomizerType, setMetarace, forceMetarace,
                                  abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                )"
                                 [required]="abilitiesRandomizerType == 'Set'" />
                        </div>
                        <label for="setCharisma" class="col-sm-2 col-form-label">Charisma:</label>
                        <div class="col-sm-2">
                          <input id="setCharisma" 
                                 name="setCharisma"
                                 pattern="^[0-9]+$"
                                 class="form-control" 
                                 type="number" 
                                 min="0" 
                                 [(ngModel)]="setCharisma" 
                                 (input)="validateRandomizers(
                                  alignmentRandomizerType, setAlignment,
                                  classNameRandomizerType, setClassName,
                                  levelRandomizerType, setLevel, allowLevelAdjustments,
                                  baseRaceRandomizerType, setBaseRace,
                                  metaraceRandomizerType, setMetarace, forceMetarace,
                                  abilitiesRandomizerType, setStrength, setConstitution, setDexterity, setIntelligence, setWisdom, setCharisma
                                )"
                                 [required]="abilitiesRandomizerType == 'Set'" />
                        </div>
                    </div>
                  }
                  <div class="d-flex justify-content-center">
                      <button id="generateCharacterButton" 
                              type="button" 
                              class="btn btn-success" 
                              (click)="generateCharacter()" 
                              [disabled]="!characterForm.form.valid || generating || validating || !valid">
                        Generate
                      </button>
                      <dndgen-loading id="characterValidating" [isLoading]="validating" [size]="sizes.Small"></dndgen-loading>
                  </div>
              </form>
          </div>
          <div role="tabpanel" class="tab-pane fade" id="leadership">
              <form name="leadershipForm" #leadershipForm="ngForm" class="form-horizontal top-buffer" role="form">
                  <div class="form-group row">
                      <label for="leaderAlignment" class="col-sm-6 col-form-label">Leader Alignment:</label>
                      <div class="col-sm-6">
                        @if (characterModel) {
                          <select id="leaderAlignment" name="leaderAlignment" class="form-select" [(ngModel)]="leaderAlignment" required>
                            @for (alignment of characterModel.alignments; track $index) {
                              <option [ngValue]="alignment">{{alignment}}</option>
                            }
                          </select>
                        }
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="leaderClassName" class="col-sm-6 col-form-label">Leader Class Name:</label>
                      <div class="col-sm-6">
                        @if (characterModel) {
                          <select id="leaderClassName" name="leaderClassName" class="form-select" [(ngModel)]="leaderClassName" required>
                            @for (className of characterModel.classNames; track $index) {
                              <option [ngValue]="className">{{className}}</option>
                            }
                          </select>
                        }
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="leaderLevel" class="col-sm-6 col-form-label">Leader Level</label>
                      <div class="col-sm-6">
                          <input id="leaderLevel" 
                                 name="leaderLevel" 
                                 pattern="^[0-9]+$" 
                                 class="form-control" 
                                 type="number" 
                                 min="6" 
                                 max="20" 
                                 [(ngModel)]="leaderLevel" 
                                 required />
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="leaderCharismaBonus" class="col-sm-6 col-form-label">Leader Charisma Bonus:</label>
                      <div class="col-sm-6">
                          <input id="leaderCharismaBonus" 
                                 name="leaderCharismaBonus" 
                                 pattern="^-?[0-9]+$" 
                                 class="form-control" 
                                 type="number" 
                                 [(ngModel)]="leaderCharismaBonus" 
                                 required />
                      </div>
                  </div>
                  <div class="form-group row">
                      <label for="leaderAnimal" class="col-sm-6 col-form-label">Leader Animal:</label>
                      <div class="col-sm-6">
                          <input id="leaderAnimal" name="leaderAnimal" class="form-control" type="text" [(ngModel)]="leaderAnimal" />
                      </div>
                  </div>
                  <div class="d-flex justify-content-center">
                      <button id="generateLeadershipButton" 
                              type="button" 
                              class="btn btn-success" 
                              (click)="generateLeadership()" 
                              [disabled]="!leadershipForm.form.valid || generating || validating || !valid">
                        Generate Leadership
                      </button>
                  </div>
              </form>
          </div>
      </div>
    </div>
    <div class="col-sm-6 clearfix">
      @if (!generating) {
        @if (character || leadership) {
          <button id="downloadButton" class="btn btn-light btn-lg float-end" (click)="download()">Download</button>
        }
        <div id="characterSection">
          @if (!character && !leadership) {
            <span id="noCharacter" class="italicize">No character has been generated</span>
          } @else if (character) {
            <dndgen-character [character]="character!"></dndgen-character>
          } @else if (leadership) {
            <div>
              <dndgen-leadership [leadership]="leadership!" [cohort]="cohort" [followers]="followers"></dndgen-leadership>
            </div>
          }
        </div>
      } @else {
        <div id="generatingSection">
          <span>{{generatingMessage}}</span>
          <div>
            <dndgen-loading [isLoading]="generating" [size]="sizes.Medium"></dndgen-loading>
          </div>
        </div>
      }
    </div>
  </div>
</dndgen-loading>
